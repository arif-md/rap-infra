name: raptor
infra:
  provider: bicep
  path: .
  deploymentStacks:
    # On azd down, delete managed resources but keep the resource group intact
    actionOnUnmanage:
      resources: delete
      resourceGroups: detach
    denySettings:
      mode: none

hooks:
  preprovision:
    windows:
      shell: pwsh
      run: |
        ./scripts/resolve-images.ps1
        ./scripts/validate-acr-binding.ps1
        ./scripts/ensure-acr.ps1
      interactive: false
    posix:
      shell: sh
      run: |
        ./scripts/resolve-images.sh
        ./scripts/validate-acr-binding.sh
        ./scripts/ensure-acr.sh
      interactive: false
  
  postprovision:
    windows:
      shell: pwsh
      run: |
        # Convert postprovision.sh to PowerShell or use WSL
        Write-Host "Post-provision tasks for Windows not yet implemented"
        Write-Host "Please run manually: bash scripts/postprovision.sh"
      interactive: false
    posix:
      shell: sh
      run: |
        ./scripts/postprovision.sh
      interactive: false
