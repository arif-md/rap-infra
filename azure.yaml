name: raptor
infra:
  provider: bicep
  path: .
  deploymentStacks:
    # On azd down, delete managed resources but keep the resource group intact
    # Key Vault is NOT in deployment stack (created by preprovision script), so it won't be deleted
    actionOnUnmanage:
      resources: delete
      resourceGroups: detach
    denySettings:
      mode: none

hooks:
  preprovision:
    windows:
      shell: pwsh
      run: ./scripts/run-preprovision-hooks.ps1
      interactive: false
    posix:
      shell: sh
      run: ./scripts/run-preprovision-hooks.sh
      interactive: false

services:
  # - Local dev: Manual grant via Azure Portal Query Editor (one-time)
  # - GitHub Actions: Automated via grant-sql-permissions.yml workflow
  # postprovision:
  #   windows:
  #     shell: pwsh
  #     run: |
  #       ./scripts/postprovision.ps1
  #     interactive: false
  #   posix:
  #     shell: sh
  #     run: |
  #       ./scripts/postprovision.sh
  #     interactive: false
